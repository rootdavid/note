# 阅读笔记

## 书籍信息

### 书名

Functional Design - Principle, Patterns, and Practices

函数式设计 - 原则，模式与实践

### 作者

Robert C Martin

### 评价

⭐⭐⭐⭐⭐

### 重要程度

⭐⭐⭐

### 阅读时间

2024-11-20

### 预计完成阅读日期

2024-11-25

## 函数式基础

### 不变性

#### 什么是函数式编程

没有赋值语句的编程

##### 记录

非常之言简意赅，不愧是Uncle Bob作品！

#### 赋值的问题

会出现**顺序耦合**或**时序耦合**

**顺序耦合**

​	代码块正确执行需要放在正确的位置才能正确运行

**时序耦合**

​	通常成对是成对出现的代码块，如：打开资源就必须释放资源。很多方面也是程序出错的祸根

#### 为什么叫它 ”函数式“

给定 `y = f(x)`，***每个x值都存在一个y值与其对应***，***执行`f`时的系统状态与`f`无关***。换句话说函数不会出现顺序耦合与时序耦合

如果始终可以使用函数调用的返回值来替换函数调用本身，这个函数就是***引用透明***的

#### 没有状态改变吗

##### 代码

```java
State system(Stete s) {
	return isFinal(s) ? s : system(s);
}
```

如果程序中没有变量就无法改变状态，***函数式程序可以靠旧状态计算出新状态***，但不改变就状态

#### 不变性概念

函数式程序不包含任何变量，任何代码都不会改变状态，一旦常量初始化就不会消失也不会改变，常量的整个历史记录都保持

### 持久性数据

#### 关于“瞒天过海”

TCO实际上是一种不可避免的瞒天过海

##### 记录

该章使用了一个“埃拉托斯特尼”筛质数的例子来改造成函数式风格的代码，代码中使用了构造函数初始变量与TCO并无不同，作者认为合理的使用变量是不违反函数式编程规范的，也是有益的

#### 制作副本

##### 记录

进一步向函数式编程风格推进

#### 结构共享

##### 记录

制作副本时直接使用内存拷贝对系统资源的消耗非常大，考虑使用多叉树来存取数据性能会好很多

让我也想到的使用JavaScript写函数式风格的代码会使用到的库[immutable-js](https://immutable-js.com/)，也是使用多叉树来维护数据副本

### 递归和迭代

#### 迭代

##### 记录

讲述了Clojure语言的简单使用

#### 递归

##### 记录

使用Clojure语言写了个递归计算斐波那契数列，**如果不使用TOC优化递归的话性能是非常差的**，并且提出了***memoize***概念

### 惰性

#### 惰性累积

只有在最终访问结果时，计算才会发生

#### 为何需要惰性

惰性将”需要做的事“与”需要做的量“分开

#### 尾声

在函数式编程中非常常见，但它几乎总处于幕后

### 状态性

#### 何时必须“可变”

涉及到多线程的时候

#### 软件事务内存

能将系统内部所使用的内存视为一个事务性的提交/回滚数据库，能在比较-交换协议的作用下防止并发更新

#### 生活不易，软件更难

STM机制能帮助我们避免最糟糕的情况